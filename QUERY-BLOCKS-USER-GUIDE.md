# Query Blocks 用户使用指南

## 🎯 功能简介

从 v1.1.0 版本开始，Orca Note AI 插件支持高级的查询功能，让你可以通过自然语言与 AI 对话来查找特定条件的笔记块。

**主要特性**:
- 🏷️ 按标签查找
- 🔍 按属性过滤（优先级、分类、作者等）
- 📊 支持多种比较操作（大于、小于、等于、为空等）
- 🤖 AI 自动理解你的查询意图

---

## 🚀 快速开始

### 1. 基本查询

**查找所有任务**:
```
帮我查找所有任务
```
AI 会自动调用 `searchBlocksByTag("task")` 查找所有带 `#task` 标签的块。

**查找包含关键词的笔记**:
```
查找包含"机器学习"的笔记
```
AI 会调用 `searchBlocksByText("机器学习")` 进行全文搜索。

### 2. 高级查询（新功能）

**查找高优先级任务**:
```
查找优先级大于等于 8 的任务
```
AI 会自动调用 `queryBlocksByTag` 并设置属性过滤：
```javascript
queryBlocksByTag("task", {
  properties: [
    { name: "priority", op: ">=", value: 8 }
  ]
})
```

**查找缺失分类的笔记**:
```
查找还没有设置分类的笔记
```
AI 会使用 `is null` 操作符：
```javascript
queryBlocksByTag("note", {
  properties: [
    { name: "category", op: "is null" }
  ]
})
```

**查找特定作者的文章**:
```
查找作者是张三的文章
```
AI 会进行文本匹配：
```javascript
queryBlocksByTag("article", {
  properties: [
    { name: "author", op: "==", value: "张三" }
  ]
})
```

---

## 📖 使用场景示例

### 场景 1: 任务管理

**查找高优先级未完成任务**:
```
查找优先级>=8且还没完成的任务
```

**查找本周到期的任务**:
```
查找截止日期在本周的任务
```

**查找没有指派负责人的任务**:
```
查找还没有设置负责人的任务
```

### 场景 2: 笔记整理

**查找草稿笔记**:
```
查找状态是"草稿"的笔记
```

**查找需要审阅的文章**:
```
查找标记为"需要审阅"的文章
```

**查找缺失标签的内容**:
```
查找还没有打标签的笔记
```

### 场景 3: 项目管理

**查找特定项目的内容**:
```
查找属于"网站重构"项目的所有内容
```

**查找进行中的项目**:
```
查找状态是"进行中"的项目
```

### 场景 4: 内容筛选

**查找特定评分的内容**:
```
查找评分>=4星的书籍笔记
```

**查找已发布的文章**:
```
查找发布状态是true的文章
```

---

## 🔧 支持的操作符

| 操作符 | 说明 | 示例 |
|--------|------|------|
| `>=` | 大于等于 | priority >= 8 |
| `>` | 大于 | score > 5 |
| `<=` | 小于等于 | priority <= 3 |
| `<` | 小于 | days < 7 |
| `==` | 等于 | status == "完成" |
| `!=` | 不等于 | category != "已归档" |
| `is null` | 为空 | category is null |
| `not null` | 不为空 | assignee not null |
| `includes` | 包含 | tags includes "重要" |
| `not includes` | 不包含 | tags not includes "已删除" |

---

## 💡 使用技巧

### 1. 自然语言提问

你不需要记住具体的语法，只需要用自然语言描述你的需求：

❌ **不推荐**（太技术化）:
```
调用 queryBlocksByTag 函数，参数是...
```

✅ **推荐**（自然语言）:
```
帮我找找优先级很高的任务
```

### 2. 明确属性名称

在你的查询中明确提到属性名称，AI 会更准确地理解：

✅ **好的示例**:
```
查找 priority 大于 8 的任务
查找 category 为空的笔记
查找 author 是张三的文章
```

### 3. 组合条件

你可以在一句话中描述多个条件：

```
查找优先级>=8 且 状态不是"已完成"的任务
查找分类是"技术"且评分>=4的笔记
```

### 4. 查看查询详情

如果你想了解 AI 实际执行了什么查询，可以打开浏览器控制台（F12），查看日志输出：

```javascript
[queryBlocksByTag] Called with: { tagName: "task", options: {...}, maxResults: 50 }
[queryBlocksByTag] Query description: {...}
[queryBlocksByTag] results: [...]
```

---

## 🐛 常见问题

### Q1: AI 没有使用高级查询功能

**问题**: 我说"查找优先级>8的任务"，但 AI 只是简单搜索了所有任务。

**解决**: 尝试更明确的表述：
- "查找 priority 属性大于 8 的任务"
- "查找属性 priority >= 8 的 task 标签的块"

### Q2: 查询没有返回结果

**问题**: 查询执行了，但返回 0 条结果。

**可能原因**:
1. 标签名称不匹配（例如使用了 "task" 但实际标签是 "任务"）
2. 属性名称不匹配（例如使用了 "priority" 但实际属性是 "优先级"）
3. 值类型不匹配（例如属性是数字但查询用了字符串）

**解决**:
- 检查实际的标签和属性名称
- 查看控制台日志确认查询参数

### Q3: 属性值类型错误

**问题**: 查询失败，提示类型错误。

**解决**: 确保值的类型正确：
- 数字属性用数字：`priority >= 8` （不是 `priority >= "8"`）
- 布尔属性用 true/false：`published == true`
- 文本属性用字符串：`author == "张三"`

插件会自动进行类型转换，但建议使用正确的类型。

### Q4: 如何查看我的块有哪些属性？

在 Orca Note 中：
1. 右键点击块
2. 选择"属性"或"Properties"
3. 查看该块的所有属性名称和值

---

## 📚 相关文档

- **实施计划**: `query_blocks_plan.md` - 完整的功能规划
- **更新日志**: `CHANGELOG-QUERY-BLOCKS.md` - 详细的技术实现
- **使用场景**: `query-blocks-scenarios.md` - 10 个实际使用场景
- **开发文档**: `CLAUDE.md` - 开发者参考

---

## 🔮 未来计划

**阶段 2: 复杂组合查询** (计划中)
- 支持 AND/OR 组合条件
- 支持嵌套查询

**阶段 3: 时间范围查询** (计划中)
- 查找"本周"、"上个月"的内容
- 支持日期范围筛选

**阶段 4: 高级功能** (计划中)
- 分组统计（例如：按状态统计任务数量）
- 日历视图
- 表格视图

---

## 📞 反馈与支持

如果你在使用过程中遇到问题或有建议，欢迎：
1. 查看控制台日志（F12）了解详细信息
2. 查看 `CHANGELOG-QUERY-BLOCKS.md` 了解已知问题
3. 向开发团队反馈

---

**版本**: v1.1.0
**更新日期**: 2024-12-20
**状态**: ✅ 阶段 1 已完成并可用
